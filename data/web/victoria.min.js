const RadioView={state:{loading:!0,inputPin:-1,lastReceived:{value:"",channel:0,timestamp:1,timeSince:""}},save(){var e=vic.query("#txtInputPin").value;m.request({method:"POST",url:"/radio",body:{inputPin:e}}).then(e=>{e.error?alert(e.error):this.oninit()})},oninit(){this.state.loading=!0,m.request({method:"GET",url:"/radio"}).then(e=>{this.state.loading=!1,this.state.inputPin=e.inputPin,this.state.lastReceived=e.lastReceived,m.redraw()})},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3","Radio"),m("p",[m(m.route.Link,{href:"/radio/rule"},"Rules"),m("span"," | "),m(m.route.Link,{href:"/radio/command"},"Commands")]),vic.renderTable({header:null,rows:[["Last Received",this.state.lastReceived.value?this.state.lastReceived.timeSince+" ago":"-"],["Value",this.state.lastReceived.value||"-"],["Channel",this.state.lastReceived.value?this.state.lastReceived.channel:"-"]]}),m("div.form",[m("p",[m("label",{for:"txtInputPin"},"Input Pin"),m("input[type=number]",{id:"txtInputPin",min:-1,max:100,value:this.state.inputPin})]),m("p",[m("button.btn",{onclick:this.save.bind(this)},"Save")])])]}},RadioRuleView={state:{loading:!0,rules:[{value:"",channel:0,press:1,action:1,serviceId:""}],services:[{id:"",name:""}],lastReceived:{value:"",channel:0},pressOptions:[[1,"Click"],[2,"Double Click"],[3,"Long Press"]],actionOptions:[[0,"None"],[1,"True"],[2,"False"],[3,"Toggle"],[4,"WiFi STA"],[5,"WiFi STA+AP"],[6,"WiFi Reset"],[7,"ESP Restart"]]},add(){this.state.rules.push({value:this.state.lastReceived.value,channel:this.state.lastReceived.channel,press:this.state.pressOptions[0][0],action:this.state.actionOptions[0][0],serviceId:""}),m.redraw()},remove(e){confirm("Are you sure you want to do it?")&&(e=parseInt(e.target.value,10),this.state.rules.splice(e,1),m.redraw())},save(){const e=vic.queryAll("input[name=Value]"),i=vic.queryAll("input[name=Channel]"),a=vic.queryAll("select[name=PressId]"),s=vic.queryAll("select[name=ActionId]"),r=vic.queryAll("select[name=ServiceId]");var t=e.map((e,t)=>({value:e.value,channel:i[t].value,press:a[t].value,action:s[t].value,serviceId:r[t].value}));m.request({method:"POST",url:"/radio/rule",body:{rules:t}}).then(e=>{e.error?alert(e.error):this.oninit()})},oninit(){this.state.loading=!0,m.request({method:"GET",url:"/radio/rule"}).then(e=>{this.state.loading=!1,this.state.rules=e.rules,this.state.services=e.services,this.state.services.unshift({id:"",name:"None"}),this.state.lastReceived=e.lastReceived,m.redraw()})},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3","Radio Rules"),m("p",[m(m.route.Link,{href:"/radio"},"< Radio")]),m("div.form",[vic.renderTable({header:["","Value","Channel","Press","Action","Service"],rows:this.state.rules.map((e,t)=>[m("button.btn.weak",{name:"Remove",value:t,onclick:this.remove.bind(this)},"Remove"),m("input[type=text]",{name:"Value",value:e.value,maxLength:8,style:{width:"60px"}}),m("input[type=number]",{name:"Channel",value:e.channel,min:-1,max:100}),vic.renderSelect("PressId",e.press,this.state.pressOptions.map(e=>({value:e[0],text:e[1]}))),vic.renderSelect("ActionId",e.action,this.state.actionOptions.map(e=>({value:e[0],text:e[1]}))),vic.renderSelect("ServiceId",e.serviceId,this.state.services.map(e=>({value:e.id,text:e.name})))])}),m("p",[m("button.btn",{onclick:this.add.bind(this)},"Add+"),m("button.btn",{onclick:this.save.bind(this)},"Save")])])]}},RadioCommandView={state:{loading:!0,commands:[{entry:1,action:1,press:1,serviceId:""}],services:[{id:"",name:""}],entryActionOptions:[["0-0","None"],["1-1","wifi-join"],["1-2","wifi-mode"],["1-3","wifi-reset"],["2-1","app-name"],["2-2","app-ota"],["3-1","esp-restart"],["4-1","boolean-set"],["4-2","boolean-toggle"]],pressOptions:[[1,"Click"],[2,"Double Click"],[3,"Long Press"]]},add(){var e=this.state.entryActionOptions[0][0].split("-");this.state.commands.push({entry:e[0],action:e[1],press:this.state.pressOptions[0][0],serviceId:""}),m.redraw()},remove(e){confirm("Are you sure you want to do it?")&&(e=parseInt(e.target.value,10),this.state.commands.splice(e,1),m.redraw())},save(){const e=vic.queryAll("select[name=EntryIdActionId]"),i=vic.queryAll("select[name=PressId]"),a=vic.queryAll("select[name=ServiceId]");var t=e.map((e,t)=>{e=e.value.split("-");return{entry:e[0],action:e[1],press:i[t].value,serviceId:a[t].value}});m.request({method:"POST",url:"/radio/command",body:{commands:t}}).then(e=>{e.error?alert(e.error):this.oninit()})},oninit(){this.state.loading=!0,m.request({method:"GET",url:"/radio/command"}).then(e=>{this.state.loading=!1,this.state.commands=e.commands,this.state.services=e.services,this.state.services.unshift({id:"",name:"None"}),m.redraw()})},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3","Radio Commands"),m("p",[m(m.route.Link,{href:"/radio"},"< Radio")]),m("div.form",[vic.renderTable({header:["","Entry","Press","Service"],rows:this.state.commands.map((e,t)=>[m("button.btn.weak",{name:"Remove",value:t,onclick:this.remove.bind(this)},"Remove"),vic.renderSelect("EntryIdActionId",e.entry+"-"+e.action,this.state.entryActionOptions.map(e=>({value:e[0],text:e[1]}))),vic.renderSelect("PressId",e.press,this.state.pressOptions.map(e=>({value:e[0],text:e[1]}))),vic.renderSelect("ServiceId",e.serviceId,this.state.services.map(e=>({value:e.id,text:e.name})))])}),m("p",[m("button.btn",{onclick:this.add.bind(this)},"Add+"),m("button.btn",{onclick:this.save.bind(this)},"Save")])])]}},ServicesView={state:{loading:!0,services:[]},add(){m.request({method:"POST",url:"/service/add"}).then(e=>{e.error?alert(e.error):m.route.set(m.buildPathname("/service/:id",{id:e.id}))})},reset(){confirm("Are you sure you want to do it?")&&m.request({method:"POST",url:"/service/reset"}).then(e=>{e.error?alert(e.error):m.route.set("/")})},oninit(){this.state.loading=!0,m.request({method:"GET",url:"/service/list"}).then(e=>{this.state.loading=!1,this.state.services=e.services,m.redraw()})},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3","Service"),m("ul",this.state.services.map(e=>m("li",[m(m.route.Link,{href:m.buildPathname("/service/:id",{id:e.id})},e.name)]))),m("p",[m("button.btn",{onclick:this.add.bind(this)},"Add+"),m("button.btn.weak",{onclick:this.reset.bind(this)},"Reset Accessory")])]}},ServiceItemView={state:{loading:!0,service:{id:"",name:"",type:1,inputPin:-1,outputPin:-1,inputTrueValue:0,outputTrueValue:0}},save(){var e=m.route.param("id"),t={id:e,name:vic.query("#txtServiceName").value,type:vic.query("input[name=ServiceType]:checked").value,inputPin:vic.query("input[name=InputPin]").value,outputPin:vic.query("input[name=OutputPin]").value,inputTrueValue:vic.query("input[name=InputPinTrueValue]:checked").value,outputTrueValue:vic.query("input[name=OutputPinTrueValue]:checked").value};m.request({method:"POST",url:"/service?id="+e,body:t}).then(e=>{e.error?alert(e.error):this.oninit()})},remove(){var e;confirm("Are you sure you want to do it?")&&(e=m.route.param("id"),m.request({method:"DELETE",url:"/service?id="+e}).then(e=>{e.error?alert(e.error):m.route.set("/service")}))},oninit(){this.state.loading=!0;var e=m.route.param("id");m.request({method:"GET",url:"/service?id="+e}).then(e=>{this.state.loading=!1,this.state.service=e.service,m.redraw()})},renderPin(e,t,i,a){return m("p",[m("label",{for:`txt${t}`},e),m("input[type=number]",{id:`txt${t}`,name:t,value:i,min:-1,max:100}),m("span","Use "),m("label",{for:`rdo${t}High`},[m("span","HIGH"),m("input[type=radio]",{id:`rdo${t}High`,name:`${t}TrueValue`,value:1,checked:1===a})]),m("label",{for:`rdo${t}Low`},[m("span","LOW"),m("input[type=radio]",{id:`rdo${t}Low`,name:`${t}TrueValue`,value:0,checked:0===a})]),m("span","as true value")])},view(){if(this.state.loading)return vic.getLoading();var e=m.route.param("id");return[vic.getNav(),m("h3",`Setting (${this.state.service.name})`),m("p",[m(m.route.Link,{href:"/service"},"< Service"),m("span"," | "),m(m.route.Link,{href:m.buildPathname("/service/state/:id",{id:e})},"State")]),m("div.form",[m("p",[m("label",{for:"txtServiceName"},"Name"),m("input[type=text]",{id:"txtServiceName",maxLength:20,value:this.state.service.name})]),m("fieldset",[m("legend","Service Type"),vic.renderRadioList("ServiceType",[this.state.service.type],[{value:1,text:"Boolean - Service with boolean value such as switcher(on/off), shake sensor(yes/no)"},{value:2,text:"Integer - Service with integer value such as temperature, humidness"}])]),m("fieldset",[m("legend","IO Pins"),this.renderPin("Input","InputPin",this.state.service.inputPin,this.state.service.inputTrueValue),this.renderPin("Output","OutputPin",this.state.service.outputPin,this.state.service.outputTrueValue)]),m("p",[m("button.btn",{onclick:this.save.bind(this)},"Save"),m("button.btn.weak",{onclick:this.remove.bind(this)},"Delete")])])]}},ServiceItemStateView={state:{loading:!0,service:{id:"",name:"",type:1},value:{boolValue:!1,intValue:0}},save(){const e={};1===this.state.service.type?e.boolValue=vic.query("input[name=BooleanValue]:checked").value:2===this.state.service.type&&(e.intValue=vic.query("#txtIntegerValue").value);var t=m.route.param("id");m.request({method:"POST",url:"/service/state?id="+t,body:e}).then(e=>{e.error?alert(e.error):this.oninit()})},oninit(){this.state.loading=!0;var e=m.route.param("id");m.request({method:"GET",url:"/service/state?id="+e}).then(e=>{this.state.loading=!1,this.state.service=e.service,this.state.value=e.value,m.redraw()})},renderBoolean(){var e=this.state.value.boolValue;return m("fieldset",[m("legend","Boolean Value"),vic.renderRadioList("BooleanValue",[e],[{value:!0,text:"On/Yes/True"},{value:!1,text:"Off/No/False"}])])},renderInteger(){var e=this.state.value.intValue;return m("fieldset",[m("legend","Integer Value"),m("p",[m("label",{for:"txtIntegerValue"},"Value"),m("input[type=number]",{id:"txtIntegerValue",value:e})])])},view(){if(this.state.loading)return vic.getLoading();var e=m.route.param("id");return[vic.getNav(),m("h3",`State (${this.state.service.name})`),m("p",[m(m.route.Link,{href:m.buildPathname("/service/:id",{id:e})},`< Setting (${this.state.service.name})`)]),m("div.form",[1===this.state.service.type?this.renderBoolean():2===this.state.service.type?this.renderInteger():null,m("p",[m("button.btn",{onclick:this.save.bind(this)},"Save")])])]}};vic.appendNav(e=>e.concat([m("span"," | "),vic.navItem("/radio","Radio"),m("span"," | "),vic.navItem("/service","Service")])),vic.appendRoute(e=>Object.assign(e,{"/radio":RadioView,"/radio/rule":RadioRuleView,"/radio/command":RadioCommandView,"/service":ServicesView,"/service/:id":ServiceItemView,"/service/state/:id":ServiceItemStateView}));