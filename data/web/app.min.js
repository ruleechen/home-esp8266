function renderSelectionList(t,i,s,e){e=e.map(e=>m("li",[m("input",{type:t,name:i,id:`rdo${i}${e.value}`,value:e.value,checked:s.includes(e.value)}),m("label",{for:`rdo${i}${e.value}`},e.text)]));return m("ul",e)}!function(e){const t=[],i=e=>{t.push(e)};i._last=[];const s=()=>{const e=t.shift()||i._last.shift();"function"==typeof e&&Promise.resolve(e()).then(s).catch(e=>console.error(e))};e.vic=i,e.addEventListener("DOMContentLoaded",s)}(window),vic.query=e=>document.querySelector(e),vic.queryAll=e=>Array.from(document.querySelectorAll(e)),vic._navFns=[],vic.appendNav=e=>vic._navFns.push(e),vic.getNav=()=>{let t=[];return vic._navFns&&vic._navFns.forEach(e=>{e=e(t);Array.isArray(e)&&(t=e)}),m("p.nav",t)},vic._routeFns=[],vic.appendRoute=e=>vic._routeFns.push(e),vic.getRoute=()=>{let t={};return vic._routeFns&&vic._routeFns.forEach(e=>{e=e(t);e&&(t=e)}),t},vic.getLoading=()=>[vic.getNav(),m("div.loading","Loading....")],vic.navItem=(e,t)=>{const i=m.route.get();var s=i===e||0===i.indexOf(e+"/");return m(m.route.Link,{href:e,class:s?"match":""},t)},vic.renderSelect=(e,t,i)=>m("select",{name:e},i.map(e=>m("option",{value:e.value,selected:t===e.value},e.text))),vic.renderTable=e=>{let t=[];return e.header&&0<e.header.length&&t.push(m("tr",e.header.map(e=>m("th.lt",[e])))),e.rows&&0<e.rows.length&&(t=t.concat(e.rows.map(e=>m("tr",e.map(e=>m("td",[e])))))),m("table",t)},vic.renderRadioList=(e,t,i)=>renderSelectionList("radio",e,t,i),vic.renderCheckList=(e,t,i)=>renderSelectionList("checkbox",e,t,i);const HomeView={state:{loading:!0,rows:[]},oninit(){this.state.loading=!0,m.request({method:"GET",url:"/home"}).then(e=>{this.state.loading=!1,this.state.rows=[["Running",e.running],["Wifi Mode",e.wifiMode],["Joined",e.joined||"-"],["STA Address",e.staAddress?m("a",{href:`http://${e.staAddress}`},e.staAddress):"-"],["STA MAC Address",e.staMacAddress],["AP Address",e.apAddress?m("a",{href:`http://${e.apAddress}`},e.apAddress):"-"],["AP MAC Address",e.apMacAddress],["Firmware Version",e.firmwareVersion]],m.redraw()})},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3","Home"),m("p",[vic.renderTable({header:null,rows:this.state.rows})])]}},FileSystemView={state:{loading:!0,infos:[],files:[]},oninit(){this.state.loading=!0,m.request({method:"GET",url:"/fs"}).then(e=>{this.state.loading=!1,this.state.infos=[["Total Bytes",e.totalBytes],["Used Bytes",e.usedBytes],["Max Path Length",e.maxPathLength],["Max Open Files",e.maxOpenFiles],["Block Size",e.blockSize],["Page Size",e.pageSize]],this.state.files=e.files,m.redraw()})},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3","File System"),m("p",[vic.renderTable({header:["Storage",""],rows:this.state.infos})]),m("p",[vic.renderTable({header:["Files","Bytes"],rows:Object.keys(this.state.files).map(e=>[m(m.route.Link,{href:m.buildPathname("/fs/file/:path",{path:e})},e),this.state.files[e]])})])]}},FileItemView={state:{loading:!0,file:{name:"",size:0,content:""}},request(e,t){var i=m.route.param("path");return m.request({method:e,url:"/file",params:{path:i},body:t})},save(){this.request("POST",{content:vic.query("textarea").value}).then(e=>{e.error?alert(e.error):this.oninit()})},remove(){confirm("Are you sure you want to do it?")&&this.request("DELETE").then(e=>{e.error?alert(e.error):m.route.set("/fs")})},oninit(){this.state.loading=!0,this.request("GET").then(e=>{this.state.file=e,this.state.loading=!1,m.redraw()})},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3",`${this.state.file.name} (${this.state.file.size} bytes)`),m("p",[m(m.route.Link,{href:"/fs"},"< Files")]),m("div.form",[m("p",[m("textarea",{cols:50,rows:10},this.state.file.content)]),m("p",[m("button.btn",{onclick:this.save.bind(this)},"Save"),m("button.btn.weak",{onclick:this.remove.bind(this)},"Delete")])])]}},WifiView={state:{loading:!0,connected:null,founds:[{ssid:"",rssi:10}],password:""},scan(){this.state.password=vic.query("#txtPassword").value,this.oninit()},join(){var e,t=vic.query("input[type=radio]:checked");t?(e=vic.query("#txtPassword"),m.request({method:"POST",url:"/wifi/join",body:{ssid:t.value,password:e.value}}).then(e=>{e.error?alert(e.error):e.ip&&alert("Success! obtain ip: "+e.ip),m.redraw()})):alert("Please select wifi to join")},oninit(){this.state.loading=!0,m.request({method:"GET",url:"/wifi"}).then(e=>{this.state.loading=!1,Object.assign(this.state,e),m.redraw()})},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3","Join WiFi"),m("div.form",[vic.renderRadioList("ssid",[this.state.connected],this.state.founds.map(e=>({value:e.ssid,text:`${e.ssid} (${-e.rssi}%)`}))),m("p",[m("label",{for:"txtPassword"},"Password"),m("input[type=text]",{id:"txtPassword",maxLength:32,value:this.state.password})]),m("p",[m("button.btn",{onclick:this.scan.bind(this)},"Scan"),m("button.btn",{onclick:this.join.bind(this)},"Join")])])]}},OtaView={state:{loading:!0,version:null,newVersion:null,rows:[]},fire(){m.request({method:"POST",url:"/ota/fire",body:{version:"",otaType:""}}).then(e=>{e.error?alert(e.error):m.redraw()})},oninit(){this.state.loading=!0,m.request({method:"GET",url:"/ota"}).then(e=>{this.state.loading=!1,this.state.version=e.otaVersion,this.state.newVersion=e.otaNewVersion,this.state.overTheWeb=e.overTheWeb,this.state.rows=[["Chip ID",e.chipId],["Chip Size",e.chipSize],["Sketch Size",e.sketchSize],["Sketch Free Space",e.sketchFreeSpace],["Sketch MD5",e.sketchMD5],["SDK Version",e.sdkVersion]],m.redraw()})},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3","OTA"),this.state.overTheWeb?m("p",[m(m.route.Link,{href:"/ota/otw"},"Update - Over The Web")]):null,m("div.form",[m("p",[vic.renderTable({header:["ESP",""],rows:this.state.rows})]),m("p","Remote Latest: "+this.state.newVersion),m("p","Local Firmware: "+this.state.version),vic.renderRadioList("OtaType",["sketch"],[{value:"all",text:"All"},{value:"sketch",text:"Sketch"},{value:"fs",text:"File System"}]),m("p",[m("button.btn",{onclick:this.fire.bind(this)},"Load + Burn "+this.state.newVersion)])])]}},OtaOtwView={view(){return[vic.getNav(),m("h3","Over The Web"),m("p",[m(m.route.Link,{href:"/ota"},"< OTA")]),m("div.form",[m("iframe",{width:"100%",height:"300",frameborder:"0",scrolling:"no",marginHeight:"0",marginWidth:"0",src:"/update"})])]}},ResetView={state:{loading:!0},reset(){var e=vic.queryAll("input[name=Reset]:checked").map(e=>e.value).join(",");m.request({method:"POST",url:"/reset",body:{values:e}}).then(e=>{e.error?alert(e.error):m.redraw()})},oninit(){this.state.loading=!1},view(){return this.state.loading?vic.getLoading():[vic.getNav(),m("h3","Reset"),m("div.form",[vic.renderCheckList("Reset",[],[{value:"EspRestart",text:"ESP Restart"},{value:"EspReset",text:"ESP Reset"},{value:"EspEraseCfg",text:"ESP Erase Config"},{value:"WifiReset",text:"Reset Wifi"}]),m("p",[m("button.btn",{onclick:this.reset.bind(this)},"Submit")])])]}},NotfoundView={view(){return"Oops... Notfound"}};vic.appendNav(e=>e.concat([vic.navItem("/","Home"),m("span"," | "),vic.navItem("/wifi","Wifi"),m("span"," | "),vic.navItem("/fs","File System"),m("span"," | "),vic.navItem("/ota","OTA"),m("span"," | "),vic.navItem("/reset","Reset")])),vic.appendRoute(e=>Object.assign(e,{"/":HomeView,"/wifi":WifiView,"/fs":FileSystemView,"/fs/file/:path":FileItemView,"/ota":OtaView,"/ota/otw":OtaOtwView,"/reset":ResetView,"/404":NotfoundView})),vic(()=>{var e=vic.query("div.main");m.route(e,"/",vic.getRoute())});